<?xml version="1.0" encoding="utf-8" ?>
<!--
  Página: loginPage.xaml
  Descripción:
  Pantalla de inicio de sesión de la aplicación ConatraCafé Soil.
  VM: LoginViewModel
  Bindings clave: Username, Password, IsBusy, IsPasswordHidden, PasswordToggleIcon,
                  RememberMe, CanUseBiometrics, UseBiometrics, BiometricEnabled
  Comandos: LoginCommand, TogglePasswordCommand, BiometricLoginCommand
-->

<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:login="clr-namespace:CONATRADEC.Views"
             x:Class="CONATRADEC.Views.loginPage"
             Shell.NavBarIsVisible="False"
             BackgroundColor="{OnPlatform WinUI='Transparent', Default={StaticResource color_Blanco}}">

    <ScrollView>
        <VerticalStackLayout Style="{StaticResource VerticalStackLayoutStyle}">

            <!-- LOGO -->
            <ImageButton Source="logocontradec.png"
                         Aspect="AspectFill"
                         Padding="0"
                         HeightRequest="200"
                         WidthRequest="200"
                         CornerRadius="100">
                <ImageButton.Clip>
                    <EllipseGeometry Center="100,100" RadiusX="80" RadiusY="80" />
                </ImageButton.Clip>
            </ImageButton>

            <!-- TÍTULO -->
            <Label Text="ConatraCafé Soil"
                   FontSize="40"
                   FontFamily="MontserratBold"
                   HorizontalOptions="Center"
                   TextColor="{StaticResource color_Negro}" />

            <!-- SUBTÍTULO -->
            <Label Text="Iniciar sesión"
                   HorizontalOptions="Center"
                   TextColor="{StaticResource color_Negro}"
                   FontSize="40"
                   FontAttributes="Bold"
                   FontFamily="MontserratMedium" />

            <!-- EMAIL -->
            <Border Style="{StaticResource BorderStyle}">
                <Entry Style="{StaticResource EntryStyle}"
                       Text="{Binding Username}"
                       x:Name="UserNameEntry"
                       Completed="UserNameEntryCompleted"
                       Placeholder="Correo electrónico"
                       Keyboard="Email" />
            </Border>

            <!-- PASSWORD -->
            <Border Style="{StaticResource BorderStyle}">
                <Grid ColumnDefinitions="*, Auto">
                    <Entry Grid.Column="0"
                           x:Name="PasswordEntry"
                           Completed="PasswordEntryCompleted"
                           Style="{StaticResource EntryStyle}"
                           Placeholder="Contraseña"
                           Text="{Binding Password}"
                           IsPassword="{Binding IsPasswordHidden}"
                           Background="Transparent" />

                    <ImageButton Grid.Column="1"
                                 Margin="10,0,0,0"
                                 Source="{Binding PasswordToggleIcon}"
                                 Command="{Binding TogglePasswordCommand}"
                                 BackgroundColor="Transparent"
                                 WidthRequest="30"
                                 HeightRequest="30" />
                </Grid>
            </Border>

            <!-- RECORDARME -->
            <HorizontalStackLayout Spacing="6" VerticalOptions="Center" HorizontalOptions="Start">
                <CheckBox IsChecked="{Binding RememberMe}" Color="{StaticResource color_Verde}"/>
                <Label Text="Recordarme"
                       VerticalOptions="Center"
                       FontFamily="MontserratMedium"
                       FontSize="14"
                       TextColor="{StaticResource color_Negro}" />
            </HorizontalStackLayout>

            <!-- SWITCH BIOMÉTRICO (solo si el dispositivo soporta biometría) -->
            <Grid RowDefinitions="Auto,Auto" IsVisible="{Binding CanUseBiometrics}">
                <Grid Padding="0,8,0,0" ColumnDefinitions="*,Auto">
                    <Label Text="Usar huella / Face ID"
                           Grid.Column="0"
                           VerticalOptions="Center"
                           FontFamily="MontserratMedium"
                           FontSize="14"
                           TextColor="{StaticResource color_Negro}" />
                    <Switch Grid.Column="1"
                            IsToggled="{Binding UseBiometrics}"
                            IsEnabled="{Binding RememberMe}" />
                </Grid>
                <Label Grid.Row="1"
                       Text="Requiere activar 'Recordarme'."
                       FontSize="12"
                       TextColor="{StaticResource color_Negro}"
                       Opacity="0.6"
                       IsVisible="{Binding RememberMe}"/>
            </Grid>

            <!-- LOADER -->
            <ActivityIndicator IsRunning="{Binding IsBusy}"
                               IsVisible="{Binding IsBusy}"
                               Color="{StaticResource color_Naranja}" />

            <!-- BOTÓN LOGIN -->
            <Button Style="{StaticResource AddButton}"
                    Text="Iniciar Sesión"
                    Padding="0,18,0,18"
                    Margin="0,10,0,0"
                    Command="{Binding LoginCommand}" 
                    IsVisible="{Binding LoginButtonVisible}"/>

            <!-- BOTÓN BIOMÉTRICO (solo si está habilitado por switch + recordarme + hardware) -->
            <Grid Margin="0,12,0,0" HorizontalOptions="Center"
                  IsVisible="{Binding BiometricEnabled}">
                <ImageButton
                    Source="fingerprint.png"
                    WidthRequest="72"
                    HeightRequest="72"
                    CornerRadius="36"
                    Padding="0"
                    Command="{Binding BiometricLoginCommand}">
                    <!-- Agrega fingerprint.png en Resources/Images (Build Action: MauiImage) -->
                </ImageButton>
            </Grid>

            <Label Text="Autenticar con huella / Face ID"
                   FontSize="12"
                   HorizontalOptions="Center"
                   TextColor="{StaticResource color_Negro}"
                   Margin="0,-4,0,0"
                   IsVisible="{Binding BiometricEnabled}" />

        </VerticalStackLayout>
    </ScrollView>
</ContentPage>
